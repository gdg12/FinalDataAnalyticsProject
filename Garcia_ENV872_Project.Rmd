---
title: "The Effect of Water Quality Parameters on Dissolved Oxygen Concentrations in Oahu"
author: "Gaby Garcia"
fontsize: 12pt
output:
  pdf_document:
    fig_caption: yes
    keep_tex: yes
    number_sections: yes
  html_document:
    df_print: paged
mainfont: Times New Roman
geometry: margin=2.54cm
subtitle: https://github.com/gdg12/FinalDataAnalyticsProject
abstract: Water bodies with higher concentrations of dissolved oxygen tend to have
  more diverse and stable aquatic ecossytems. This data analysis focuses on the water
  quality parameters that have statistical significance on dissolved oxygen concentrations
  at coastal monitoring locations on the island of Oahu. A multiple linear regression
  was performed encompassing all continuous water quality parameters that were not
  multicollineated with dissolved oxygen. The analysis demonstrates that enterococcus,
  temperature, pH, and salinity are statistically significant explanatory variables
  for dissolved oxygen concentrations in Oahu. A spatial analysis of dissolved oxygen
  concentrations was performed for the North, South, East, and West coasts of Oahu;
  however, no strong trend was apparent. A temporal analysis of dissolved oxygen was performed;
  dissolved oxygen concentrations were lowest in the summer months and highest in
  the winter months.
---


\tableofcontents 




\newpage


#Setup
```{r, message=FALSE, warning=FALSE}
setwd("~/Desktop/Environmental Data Analytics/Environmental_Data_Analytics/Final Project/Raw Data")
OahuData<-read.csv('OahuData.csv')
```

##Load Necessary Packages
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(tidyr)
library(ggplot2)
library(GGally)
library(dplyr)
library(plyr)
library(lubridate)
library(viridis)
library(RColorBrewer)
library(colormap)
library(gridExtra)
library(corrplot)
library(nlme)
library(lsmeans)
library(multcompView)
library(trend)
library(mapview)
library(leaflet)
library(sf)
library(car)
library(stats)
library(wesanderson)
library(scales)
library(extrafont)
```


##Set GGPlot Theme
```{r}
gabytheme <- theme_bw(base_size = 14) + 
  theme(plot.title=element_text(face="bold", size="15",
                                color="Indianred4", hjust=0.5),
        axis.title=element_text(face="bold.italic", size=11, 
                                color="black"),
axis.text = element_text(face="bold", size=10, color = "black"), 
panel.background=element_rect(fill="white",
                              color="darkblue"), 
panel.border = element_rect(color = "black",
                            size = 2),
legend.position = "top", 
legend.background = element_rect(fill="white", color="black"),
            legend.key = element_rect(fill="transparent", color="NA"))
theme_set(gabytheme)
```


# Research Question and Rationale

The economic well being of island states such as Hawaii partially depends on thriving coastal ecosystems. Therefore, it is important to analyze time series water quality data featuring parameters such as dissolved oxygen. Dissolved oxygen (DO) is one of the best indicators of a water body's health. Water bodies with higher DO concentrations are healthier and support diverse aquatic plants and animals. Water bodies with low DO concentrations are often severely polluted. The amount of dissolved oxygen that a specific water body can hold is a function of altitude (atmospheric pressure), volume of water, amount of nutrients in the water, aquatic organisms in the water, salinity, water temperature, and the amount of other substances dissolved in the water, in addition to more parameters.  Cool water can hold more oxygen than warm water, with variations ranging from seasonal to time of day or night. Water with higher salinity has a lower DO concentration than water with lower salinity at the same temperature. I am interested in examining what water quality parameters affects dissolved oxygen concentrations in Hawaii. 


After some searching for water quality data on data.gov, I found a dataset from the Monitoring Section of the State of Hawaii, Department of Health, Clean Water Branch (CWB). The CWB collected water quality field parameters at over 300 coastal monitoring locations in all of Hawaii's islands using well-established instruments and methodologies. The original dataset I found on data.gov spanned 1999-2006. Because I wanted to account for more recent data, I found the complete dataset spanning through 2019 on the Hawaii Clean Water Branch's website. The complete list of relevant parameters are: Location Identifier, Location Name, Island, Latitude of Sample, Longitude of Sample, Sample Number, Date Sample was Collected, Time Sample was collected, Enterococci, Temperature, Salinity, Dissolved Oxygen, Percent Saturation of Dissolved Oxygen, pH, turbidity, Specific Heat of Water (Cp), and relevant comments about water/weather conditions (if applicable). I decided to filter the data for the island of Oahu only because the original dataset included data for all of the islands, and Oahu is home to two-thirds of Hawaii's population and hosts Honolulu, the capital. My reasoning was that a higher island population could lead to more water body pollution. In addition, I left out Percent Saturation of Dissolved Saturation as an explanatory variable because 

The null hypothesis of this statistical test is that pH, turbidity, salinity, temperature, enterococcus concentrations, and specific heat have no effect on the dissolved oxygen concentrations in Oahu. This would be represented by the equation xYi=Bo+Ei. The alternative hypothesis is that at least one of the predictor variables have an effect on dissolved oxygen concentrations in Oahu, which would be represented by the equation xYi=Bo +B1X1 +BnXn+... +Ei.
My research questions are: 1.) Which of the parameters have a statistically significant relationship with dissolved oxygen concentrations? Of these relevant parameters, which of them have the most significant effect on dissolved oxygen concentrations over time? What is the magnitude and direction of any effects? 2. Do dissolved oxygen concentrations vary spatially across the island of Oahu? 



\newpage

# Dataset Information

<Information on how the dataset for this analysis were collected, the data contained in the dataset, and any important pieces of information that are relevant to your analyses. This section should contain much of same information as the README file for the dataset but formatted in a way that is more narrative.>

Water Quality Data was sampled by the State of Hawaii Department of Health Clean Water Branch (specifically, their Beach Monitoring Program).The dataset contains data from the Statewide Water Quality Sampling Dataset from 373 coastal monitoring sites in Hawaii from 1999-2019. All sampling and testing was done in accordance with test procedures approved under 40 CFR Part 136 unless other test procedures have been specified in the permit or approved by the director. 

Data only from the Island of Oahu was selected from 01/01/1999 to 04/12/2019. 

##Omit NA's from Data
```{r}
OahuDataClean<- na.omit(OahuData) 
```


##Change Date from Factor to Date Object
```{r}
OahuDataClean$Date<-as.Date(OahuDataClean$Date, format = "%m/%d/%y") 
```


###Add a Week, Month, and Year Column to Dataframe Using Mutate Function
```{r}
OahuDataClean<-mutate(OahuDataClean, Week = week(Date))
OahuDataClean<- mutate(OahuDataClean, Month = month(Date))
OahuDataClean<- mutate(OahuDataClean, Year = year(Date))
```


##Create Data Structure Table
```{r}
OahuDataCleanSummary<-OahuDataClean%>%
  group_by(Month)%>%
 summarize(MeanDO=mean(DO, na.rm=TRUE), 
           MeanDOPercentSaturation=mean(DissolvedOxygenSaturation, na.rm=TRUE), 
           MeanWaterTemperature=mean(Temperature, na.rm=TRUE) ,
           MeanSalinity=mean(Salinity,na.rm=TRUE), 
           MeanTurbidity=mean(Turbidity,na.rm=TRUE), 
           MeanpH=mean(pH,na.rm=TRUE),
           MeanEnterococcus=mean(Enterococcus,na.rm=TRUE), 
           meanCP=mean(CP.Result, na.rm=TRUE))

```


\newpage

# Exploratory Data Analysis and Wrangling

##Structure of Water Data
```{r}
str(OahuDataClean)
```

##Summary of Water Data
```{r}
summary(OahuDataClean)
```

##Dimensions of Water Data
```{r}
dim(OahuDataClean)
```

##View First 10 Rows of Water Data
```{r}
head(OahuDataClean, 10)
```

##View all Column Names
```{r}
colnames(OahuDataClean)
```


##Attach Data
```{r, warning=FALSE, message=FALSE}
attach(OahuDataClean)
```

#Recoding Observations to Regions in Oahu

##Convert Location Identifier from Number to Factor
```{r}
OahuDataClean$LocationIdentifier<-as.factor(OahuDataClean$LocationIdentifier)
```

##Use Revalue function to recode Station Numbers into Geographical Regions
```{r, message=FALSE, warning=FALSE}
library(plyr)
OahuDataClean$Region<-revalue(OahuDataClean$LocationIdentifier,
                              c('152'='South', '153'='South',
                                                                 
                                '154'='South',  '155'='South',
                                                                 
                                 '156'='South', '157'='South', 
                                                                  
                                '158'='South', '159'='South', 
                                                                  
                                '160'='South','161'='South', 
                                                                
                                  '162'='South', '165'='South', 
                                                                 
                                 '169'='North', '170'='North', 
                                                                  
                                '171'='North','172'='North',
                                                                 
                                 '173'='North',   '175'='East', 
                                                                  
                                '176'='East', '177'='East', 
                                                                 
                                 '179'='North', '181'='West', 
                                                                 
                                 '182'='West', '183'='West', 
                                                                 
                                 '184'='West', '185'='West',  
                                                                 
                                 '186'='West', '187'='West','188'='West',
                                                                 
                                 '189'='South', '191'='East', '193'='East', 
                                                                 
                                 '194'='East', '195'='East','196'='East',
                                                                 
                                 '197'='East', '198'='East', '200'='South', 
                                                                 
                                 '201'='South','202'='South', '203'='South', 
                                                                 
                                 '204'='South', '205'='East', '207'='East', 
                                                                 
                                 '208'='East', '211'='South','212'='South', 
                                                                 
                                 '213'='South', '214'='South', '215'='West',
                                                                  
                                '216'='East','217'='South', '218'='North', 
                                                                 
                                 '221'='East',  '222'='South',   '224'='West',
                                                                  
                                '225'='North', '226'='East',  '227'='East', 
                                                                 
                                 '228'='South',  '229'='South', '230'='East',
                                                                 
                                 '231'='South',  '232'='North', '233'='West', 
                                                                 
                                 '234'='South', '235'='South',  '236'='South', 
                                                                 
                                 '237'='South', '238'='South', '239'='South',
                                                                 
                                 '240'='South', '241'='East', '242'='East', 
                                                                 
                                 '243'='East', '244'='North', '245'='North',  
                                                                 
                                 '246'='North',  '247'='North',  '249'='West', 
                                                                 
                                 '250'='West', '251'='West', '252'='West',  
                                                                
                                  '253'='East',  '254'='South', '255'='South',
                                                                 
                                 '256'='South',  '257'='South', '258'='South', 
                                                                 
                                 '259'='South', '260'='East',   '261'='East',
                                                                  
                                '262'='East','263'='North',  '264'='North', 
                                                                 
                                 '265'='North',  '266'='North', '267'='North', 
                                                                 
                                 '268'='West', '269'='West', '270'='South', 
                                                                 
                                 '271'='West', '272'='West',  '273'='West',  
                                                                 
                                 '274'='West', '275'='South', '276'='South',
                                                                 
                                 '277'='South', '278'='South', '279'='South', 
                                                                 
                                 '280'='South', '281'='East', '282'='East', 
                                                                 
                                 '283'='West', '284'='East', '285'='East', 
                                                                 
                                 '286'='East', '287'='East', '288'='North', 
                                                                
                                  '289'='North', '290'='North',  '291'='North', 
                                                                
                                  '292'='West', '293'='West', '294'='West', 
                                                                 
                                 '295'='West', '296'='West', '297'='North',
                                                                
                                  '298'='North', '299'='North', '304'='East',
                                                                 
                                 '305'='South', '306'='North', '307'='South',
                                                                 
                                 '308'='South', '309'='West','310'='South', 
                                                                 
                                 '311'='South', '312'='South', '313'='North',
                                                                 
                                 '314'='West', '315'='West','316'='South', 
                                                                 
                                 '317'='South', '322'='South', '323'='South',
                                                                 
                                 '324'='East','325'= 'East', '326'='East', '327'='East',
                                                                  
                                '328'='East', '329'='East',  '362'='East', '387'='East',
                                                                  
                                '388'='North', '389'='East', '411'='South', '412'='South',
                                                                 
                                 '413'='South', '414'='South', '415'='South', '416'='South'))                                                    
```


##Remove Observations that are not actually in Oahu
```{r}
OahuDataClean<-OahuDataClean[-c(18913,19032,19156, 19287, 19384, 19476,
                                19567, 19745, 19904, 20041, 109, 226, 
                                341, 448, 782, 11859, 13295, 18976, 19228, 
                                19352, 19516, 19685, 19846, 19971, 20104, 
                                14806, 16777, 16805, 16826, 
                                16887, 16921, 16950, 4957, 5061, 
                                5120, 5163, 5206, 5259, 5300), ]
```


##Remove incorrect latitudes and longitudes
```{r}
library(dplyr)
OahuDataClean<- filter(OahuDataClean, LocationIdentifier != 324 & 
                                     LocationIdentifier != 325 & 
                         LocationIdentifier != 326 &
                                     LocationIdentifier != 327 &
                         LocationIdentifier != 328 &
                         LocationIdentifier != 329)
```

##Determine Number of Observations for Each Region in Oahu
```{r}
summary(OahuDataClean$Region)
```

##Remove observations of 0 (can't log-transform data with 0's)
```{r}
 OahuDataClean2<-OahuDataClean %>%   ###pipe indicates then
  filter(Temperature!=0, Salinity!=0, DO!=0, DissolvedOxygenSaturation!=0, 
         pH!=0, Turbidity!=0)   
```

#Variable Exploration

##Temperature
```{r}
ggplot(OahuDataClean2) +
  geom_histogram(aes(x =Temperature), binwidth=0.3)
```

###QQNorm for Temperature
```{r}
 qqnorm(OahuDataClean2$Temperature) 
qqline(OahuDataClean2$Temperature)
```


###LogTransform Temperature
```{r}
qqnorm(log(OahuDataClean2$Temperature))
qqline(log(OahuDataClean2$Temperature))
```

###Perform Shapiro Wilks Normality test for first 5,000 Temperature observations
```{r}
shapiro.test(OahuDataClean2$Temperature[0:5000])
```
####Reject null hypothesis that Temperature is normally distributed.


###Summary of Temperature
```{r}
summary(OahuDataClean2$Temperature)
```

###Plot Temperature against DO
```{r, warning=FALSE, message=FALSE}
TempbyDO <- 
  ggplot(OahuDataClean2, aes(x =Temperature, y =DO)) +
  geom_point(color="tomato3", alpha=1, size=0.5) +
  geom_smooth(method=lm, color="black") +
  labs(title="The Effect of Water Temperature on DO across Oahu", 
       x="Water Temperature (degrees C)", y="Dissolved Oxygen (mg/L)")
print(TempbyDO) 
```

##pH
```{r, message=FALSE, warning=FALSE}
ggplot(OahuDataClean2) +
  geom_histogram(aes(x =pH))+
   scale_x_continuous(limits = c(0, 12))
```

###QQNorm of pH
```{r}
 qqnorm(OahuDataClean2$pH) 
qqline(OahuDataClean2$pH)
```

###Shapiro Wilks Test for pH
```{r}
shapiro.test(OahuDataClean2$pH[0:5000])
```

###Summary of pH
```{r}
summary(OahuDataClean2$pH)
```

###Plot pH against DO
```{r, warning=FALSE, message=FALSE}
pHbyDO <- 
  ggplot(OahuDataClean2, aes(x =pH, y =DO)) +
  geom_point(color="tomato3", alpha=1, size=0.5) +
  geom_smooth(method=lm, color="black", se=FALSE) +
  labs(title="The Effect of pH on DO Concentrations across Oahu", 
       x="pH",
       y="Dissolved Oxygen (mg/L)")+
   scale_x_continuous(limits = c(0, 12))
print(pHbyDO) 
```

##Dissolved Oxygen Concentrations
```{r, message=FALSE, warning=FALSE}
ggplot(OahuDataClean2) +
  geom_histogram(aes(x =DO)) +
scale_x_continuous(limits = c(0, 15))
```

###QQNorm of DO
```{r}
 qqnorm(OahuDataClean2$DO) 
qqline(OahuDataClean2$DO)
```

###Shapiro Wilks Test for DO
```{r}
shapiro.test(OahuDataClean2$DO[0:5000])
```

###Summary of DO
```{r}
summary(OahuDataClean2$DO)
```

##Percent Saturation of Dissolved Oxygen
```{r, message=FALSE}
ggplot(OahuDataClean2) +
  geom_histogram(aes(x =DissolvedOxygenSaturation))
```

###QQnorm of Percent Saturation of Dissolved Oxygen
```{r}
qqnorm(OahuDataClean2$DissolvedOxygenSaturation) 
qqline(OahuDataClean2$DissolvedOxygenSaturation)
```

###Shapiro Test for Percent Saturation Dissolved Oxygen
```{r}
shapiro.test(OahuDataClean2$DissolvedOxygenSaturation[0:5000])
```

###Summary of Percent Saturation of Dissolved Oxygen
```{r}
summary(OahuDataClean2$DissolvedOxygenSaturation)
```

##Turbidity
```{r, message=FALSE, warning=FALSE}
ggplot(OahuDataClean2) +
  geom_histogram(aes(x =Turbidity)) +
   scale_x_continuous(limits = c(0, 100))
```

###QQNorm of Turbidity
```{r}
qqnorm(OahuDataClean2$Turbidity) 
qqline(OahuDataClean2$Turbidity)
```

###Shapiro Test for Turbidity
```{r}
shapiro.test(OahuDataClean2$Turbidity[0:5000])
```

###Summary of Turbidity
```{r}
summary(OahuDataClean2$Turbidity)
```

###Plot Turbidity against DO
```{r, warning=FALSE, message=FALSE}
TurbiditybyDO <- 
  ggplot(OahuDataClean2, aes(x =Turbidity, y =DO)) +
  geom_point(color="tomato3", alpha=1, size=0.5) +
  geom_smooth(method="lm", se=FALSE) +
   scale_y_continuous(limits = c(0, 25)) +
  
  labs(title="The Effect of Turbidity on DO Concentrations across Oahu",
       x="Turbidity (NTU)", y="Dissolved Oxygen (mg/L)")
print(TurbiditybyDO) 
```

##Salinity
```{r, message=FALSE}
ggplot(OahuDataClean2) +
  geom_histogram(aes(x =Salinity))
```

###QQNorm of Salinity
```{r}
qqnorm(OahuDataClean2$Salinity) 
qqline(OahuDataClean2$Salinity)
```

###Shapiro Test for Salinity
```{r}
shapiro.test(OahuDataClean2$Salinity[0:5000])
```


###Summary of Salinity
```{r}
summary(OahuDataClean2$Salinity)
```

###Plot Salinity Against DO
```{r}
SalinitybyDO <- 
  ggplot(OahuDataClean2, aes(x =Salinity, y =DO)) +
  geom_point(color="tomato3", alpha=1, size=0.5) +
  geom_smooth(method=lm, color="black", se=FALSE) +
  labs(title="The Effect of Salinity on DO Concentrations across Oahu",
       x="Salinity (ppt)", y="Dissolved Oxygen (mg/L)")
print(SalinitybyDO) 
```


##Enterococcus
```{r, message=FALSE}
ggplot(OahuDataClean2) +
  geom_histogram(aes(x =Enterococcus))
```


###QQNorm of Enterococcus
```{r}
qqnorm(OahuDataClean2$Enterococcus) 
qqline(OahuDataClean2$Enterococcus)
```

###Shapiro Test for Enterococcus
```{r}
shapiro.test(OahuDataClean2$Enterococcus[0:5000])
```


###Summary of Enterococcus
```{r}
summary(OahuDataClean2$Enterococcus)
```

####Convert Date Column to a Date Object
```{r}
OahuDataClean2$Date<-as.Date(OahuDataClean2$Date, format="%m/%d/%y")
```

#Correlation Plot of Data
```{r, fig.height=8, fig.width=12, message=FALSE, warning=FALSE}
ggpairs(OahuDataClean, columns=c(9, 13:18), 
        title="Correlation Plot of Oahu Water Quality Parameters")
```



#Exploratory Boxplot showing Range of DO Concentrations by Region in Oahu
```{r, fig.height =8, fig.width = 10, warning=FALSE, message=FALSE}
DOBoxplot<-ggplot(OahuDataClean) + 
  geom_boxplot(aes(x=Region, y=DO, fill=Region))  +
  labs(title="Effect of Region on Range of Dissolved Oxygen Concentrations in Oahu",
       x="Region in Oahu", y="Dissolved Oxygen Concentration (mg/L)") +
theme(legend.title = element_text(colour="IndianRed", size=16, face="bold")) +
  gabytheme +
scale_fill_brewer(palette="Set3") +
  scale_y_continuous(limits = c(0, 12))
 print(DOBoxplot)
```


\newpage

# Statistical Analysis
<Include R chunks for 3+ statistical tests (display code and output) and 3+ final visualization graphs (display graphs only).>

<Include text sections to accompany these R chunks to explain the reasoning behind your workflow, rationale for your approach, and the justification of meeting or failing to meet assumptions of tests.>

##Full Maximal Model
```{r, message=FALSE}
attach(OahuDataClean)
HawaiiModClean<-lm(DO~Enterococcus + Temperature +Salinity +pH + 
                     Turbidity + CP.Result, data=OahuDataClean)
summary(HawaiiModClean)
```



##Remove Specific Heat Parameter
```{r}
HawaiiModClean2<-update(HawaiiModClean,.~.-CP.Result)
summary(HawaiiModClean2)
```

##Remove Turbidity Parameter
```{r}
HawaiiModClean3<-update(HawaiiModClean2,.~.-Turbidity)
summary(HawaiiModClean3)
```



##AIC Test of all Models
```{r}
AIC(HawaiiModClean, HawaiiModClean2, HawaiiModClean3)
```

##Partial F-test of all Models
```{r}
anova(HawaiiModClean, HawaiiModClean2, HawaiiModClean3)
```

##Check for Multicollinearity of Final Model
```{r}
vif(HawaiiModClean3)
```

##Check Residuals of HawaiiModClean3
```{r}
par(mfrow=c(2,2))
plot(HawaiiModClean3)
```

#Research question: Is there a trend over time in DO concentrations by region in Oahu? 

##Split Dataset by Region
```{r}
HawaiiWaterCleanOahuNorth<- filter(OahuDataClean, Region== "North")
HawaiiWaterCleanOahuSouth<- filter(OahuDataClean, Region== "South")
HawaiiWaterCleanOahuEast<- filter(OahuDataClean, Region== "East")
HawaiiWaterCleanOahuWest<- filter(OahuDataClean, Region== "West")
```


##Run a Mann Kendall Test for North Oahu
```{r}
library(trend)
mk.test(HawaiiWaterCleanOahuNorth$DO)
```

##Run a Mann Kendall Test for South Oahu
```{r}
library(trend)
mk.test(HawaiiWaterCleanOahuSouth$DO)
```

##Run a Mann Kendall Test for East Oahu
```{r}
library(trend)
mk.test(HawaiiWaterCleanOahuEast$DO)
```

##Run a Mann Kendall Test for West Oahu
```{r}
library(trend)
mk.test(HawaiiWaterCleanOahuWest$DO)
```
For North Oahu, the z-value is 17.91, so we see a negative trend in DO concentrations over time. The p-value is  < 2.2e-16,so we reject the null hypothesis that the data come from a population with independent realizations and are identically distributed . For South Oahu, the z-value is -28.477, so we see a negative trend in DO concentrations over time. The p-value for South Oahu is listed as 9.14e-13, so we reject the null hypothesis that the data come from a population with independent realizations and are identically distributed. For East Oahu, the z-value is -23.022, and p-value is < 2.2e-16, so we reject the null hypothesis that the data come from a population with independent realizations and are identically distributed; there is a negative trend in DO concentrations over time. For West Oahu, the z-value is -21.849, so there is also a negative trend in DO concentrations over time. 

#North Oahu

##Arrange North Oahu Dataset by Date (ascending)
```{r}
HawaiiWaterCleanOahuNorth<-arrange(HawaiiWaterCleanOahuNorth, Date)
```

##Pettit's Test for North Oahu
```{r}
pettitt.test(HawaiiWaterCleanOahuNorth$DO)
```
Because the p-value is <0.05, the change point is significant. Given 1st change point for North Oahu is 1332, we scroll to observation 1332 in data set, so first change point occurred in 2009-01-12. 


##Run a separate Mann-Kendall Test for Each Change Point
```{r}
mk.test(HawaiiWaterCleanOahuNorth$DO[1:1331])
mk.test(HawaiiWaterCleanOahuNorth$DO[1332:2638])
```
Second change point p-value<0.05, so there is a significant second change point.


##What is the second change point?
```{r}
pettitt.test(HawaiiWaterCleanOahuNorth$DO[1332:2638])  
```
1332 + 942=2274, so look at 2274 row in datatable to see second change point. It happened on 2017-10-19.


##Check for a third change point
```{r}
mk.test(HawaiiWaterCleanOahuNorth$DO[1332:2273])  
mk.test(HawaiiWaterCleanOahuNorth$DO[2274:2638])  
```
If z-score is positive, it's a positive trend in DO concentrations over time. If z-score is negative, it is a negative trend in DO concentrations over time. There is a significant trend for rows:2856:3271 because the p-value is below 0.05, so there is a third changepoint. 

##What is third change point?
```{r}
pettitt.test(HawaiiWaterCleanOahuNorth$DO[2274:2638])  
```
2274+215=2489-->Third change point happened on 2018-11-29


###Change Date to be a date object
```{r}
HawaiiWaterCleanOahuNorth$Date<-as.Date(HawaiiWaterCleanOahuNorth$Date, 
                                        format = "%m/%d/%y")
```


##Time Series of DO Concentrations in North Oahu with Changepoints
```{r North Oahu, warning=FALSE, message=FALSE, fig.height =9, fig.width = 18, echo=FALSE}
NorthOahuTimeSeries<-ggplot(HawaiiWaterCleanOahuNorth, aes(x =Date, y =DO)) + 
  geom_point() +

  geom_vline(xintercept=as.Date("2009-01-12"),color="253494",
             origin= "1970-01-01", lty=2, lwd=2) +
  geom_vline(xintercept=as.Date("2017-10-19"), color="253494", lty=2, lwd=2)+
    geom_vline(xintercept=as.Date("2018-11-29"),color="253494", 
               origin= "1970-01-01", lty=2, lwd=2)+

  geom_smooth(aes(x = Date, y = DO, span=0.1), se=FALSE, color="indianred3", 
              linetype=1, size=2)+
  labs(title="The Effect of Sample Date on Dissolved Oxygen Concentrations in North Oahu", 
       x="Sample Date",
       y="Dissolved Oxygen (mg/L)") +
 
scale_x_date(labels = date_format("%m/%Y"), breaks = date_breaks("6 month")) +
scale_y_continuous(limits=c(0,10), breaks=seq(0,10, by = 0.5))

NorthOahuTimeSeries
```


#South Oahu 


##Change Date to be a date object
```{r}
HawaiiWaterCleanOahuSouth$Date<-as.Date(HawaiiWaterCleanOahuSouth$Date, 
                                        format = "%m/%d/%y")
```


##Arrange South  Oahu Dataset by Date (ascending)
```{r}
HawaiiWaterCleanOahuSouth<-dplyr::arrange(HawaiiWaterCleanOahuSouth, Date)
```

##Pettit's Test for South Oahu
```{r}
pettitt.test(HawaiiWaterCleanOahuSouth$DO)
```
Because the p-value is <0.05, the change point is significant. Given 1st change point for South Oahu is 9303, we scroll to observation 9303 in data set, so first change point occurred in 2012-12-12

##Run a separate Mann-Kendall Test for Each Change Point
```{r}
mk.test(HawaiiWaterCleanOahuSouth$DO[1:9302])
mk.test(HawaiiWaterCleanOahuSouth$DO[9303:12262])
```
p-value for [9303:12262] is significant, so run a Pettit's Test for second change point


##What is second change point?
```{r}
pettitt.test(HawaiiWaterCleanOahuSouth$DO[9303:12262])
```
9303 + 1922=11235, scroll to observation 11225 in data set, so second change point occurred in 2017-11-28


## Run another Mann-Kendall to check for second change point
```{r}
mk.test(HawaiiWaterCleanOahuSouth$DO[9303:11224])   
mk.test(HawaiiWaterCleanOahuSouth$DO[11225:12262])  
```
Because p<0.05, there is a significant change point in rows [11225:12262]

##Third Change Point
```{r}
pettitt.test(HawaiiWaterCleanOahuSouth$DO[11225:12262])
```
11225+ 692=11917-->third change point occurred 2018-12-04

##Time Series of DO Concentrations in South Oahu with Changepoints
```{r South Oahu, warning=FALSE, message=FALSE, fig.height =9, fig.width = 18, echo=FALSE}
SouthOahuTimeSeries<-ggplot(HawaiiWaterCleanOahuSouth, aes(x =Date, y =DO)) + 
  geom_point() +
 
  geom_vline(xintercept=as.Date("2012-12-12"),color="253494", 
             origin= "1970-01-01", lty=2, lwd=2) +
  geom_vline(xintercept=as.Date("2017-11-28"), color="253494",
             lty=2, lwd=2)+
  geom_vline(xintercept=as.Date("2018-12-04"),color="253494", 
             origin= "1970-01-01", lty=2, lwd=2) +
  geom_smooth(aes(x = Date, y = DO, span=0.1), se=FALSE, color="indianred3", 
              linetype=1, size=2)+
  labs(title="The Effect of Sample Date on Dissolved Oxygen Concentrations in South Oahu", 
       x="Sample Date",
       y="Dissolved Oxygen (mg/L)") +
  scale_x_date(labels = date_format("%m/%Y"), breaks = date_breaks("6 month")) +
 scale_y_continuous(limits=c(0,10), breaks=seq(0,10, by = 0.5))
SouthOahuTimeSeries
```


#West Oahu 

##Change Date to be a date object
```{r}
HawaiiWaterCleanOahuWest$Date<-as.Date(HawaiiWaterCleanOahuWest$Date,
                                       format = "%m/%d/%y")
```


##Arrange West Oahu Dataset by Date (ascending)
```{r}
HawaiiWaterCleanOahuWest<-dplyr::arrange(HawaiiWaterCleanOahuWest, Date)
```

##Pettit's Test for West Oahu
```{r}
pettitt.test(HawaiiWaterCleanOahuWest$DO)
```
Because the p-value is <0.05, the change point is significant. Given 1st change point for West Oahu is 1752, we scroll to observation 1752 in data set, so first change point occurred in 2009-01-20

##Run a separate Mann-Kendall Test for Each Change Point
```{r}
mk.test(HawaiiWaterCleanOahuWest$DO[1:1751])
mk.test(HawaiiWaterCleanOahuWest$DO[1752:3316])
```
p-value for [1752:3316] is significant, so run a Pettit's Test for second change point


##What is second change point?
```{r}
pettitt.test(HawaiiWaterCleanOahuWest$DO[1752:3316])
```
1752+ 1118=2870, scroll to observation 2870 in data set, so second change point occurred in 2017-11-29



## Run another Mann-Kendall to check for third change point
```{r}
mk.test(HawaiiWaterCleanOahuWest$DO[1752:2869])   
mk.test(HawaiiWaterCleanOahuWest$DO[2870:3316])
```
Because p<0.05, there is a significant change point in rows [2870:3316]

##Third Change Point
```{r}
pettitt.test(HawaiiWaterCleanOahuWest$DO[2870:3316])
```
Third change point is 2870+ 273=3143, which happened on 2018-11-14



##Time Series of DO Concentrations in West Oahu with Changepoints
```{r West Oahu, warning=FALSE, message=FALSE, fig.height =9, fig.width = 18, echo=FALSE}
WestOahuTimeSeries<-ggplot(HawaiiWaterCleanOahuWest, aes(x =Date, y =DO)) + 
  geom_point() +
 
  geom_vline(xintercept=as.Date("2009-01-20"),color="253494",
             origin= "1970-01-01", lty=2, lwd=2) +
  geom_vline(xintercept=as.Date("2017-11-29"), color="253494", 
             lty=2, lwd=2)+
  geom_vline(xintercept=as.Date("2018-11-14"),color="253494",
             origin= "1970-01-01", lty=2, lwd=2) +
  geom_smooth(aes(x = Date, y = DO, span=0.1), se=FALSE, color="indianred3", 
              linetype=1, size=2)+
  labs(title="The Effect of Sample Date on Dissolved Oxygen Concentrations in West Oahu", 
       x="Sample Date",
       y="Dissolved Oxygen (mg/L)") +
  scale_x_date(labels = date_format("%m/%Y"), 
               breaks = date_breaks("6 month")) +
 scale_y_continuous(limits=c(0,10), 
                    breaks=seq(0,10, by = 0.5))
WestOahuTimeSeries

```

#East Oahu
##Change Date to be a date object
```{r}
HawaiiWaterCleanOahuEast$Date<-as.Date(HawaiiWaterCleanOahuEast$Date,
                                       format = "%m/%d/%y")
```


##Arrange East Oahu Dataset by Date (ascending)
```{r}
HawaiiWaterCleanOahuEast<-dplyr::arrange(HawaiiWaterCleanOahuEast, Date)
```

##Pettit's Test for East Oahu
```{r}
pettitt.test(HawaiiWaterCleanOahuEast$DO)
```
Because the p-value is <0.05, the change point is significant. Given 1st change point for East Oahu is 3549, we scroll to observation 3549 in data set, so first change point occurred in 2014-11-17


##Run a separate Mann-Kendall Test for Each Change Point
```{r}
mk.test(HawaiiWaterCleanOahuEast$DO[1:3548])
mk.test(HawaiiWaterCleanOahuEast$DO[3549:4694])
```
p-value for [3549:4694] is significant, so run a Pettit's Test


##What is second change point?
```{r}
pettitt.test(HawaiiWaterCleanOahuEast$DO[3549:4694])
```
3549+ 614=4163, so look at 4163th row-> second change point occurred on 2017-11-27

## Run another Mann-Kendall for the third change point
```{r}
mk.test(HawaiiWaterCleanOahuEast$DO[3549:4162])   
mk.test(HawaiiWaterCleanOahuEast$DO[4163:4694])  
```
Because p<0.05, there is a significant change point in rows [4163:4694]

##Third Change Point
```{r}
pettitt.test(HawaiiWaterCleanOahuEast$DO[4163:4694])
```
Third change point is 4163+ 351=4514, which happened on 2018-12-04

##Time Series of DO Concentrations in East Oahu with Changepoints
```{r East Oahu, warning=FALSE, message=FALSE, fig.height =9, fig.width = 18, echo=FALSE}
EastOahuTimeSeries<-ggplot(HawaiiWaterCleanOahuEast, aes(x =Date, y =DO)) + 
  geom_point() +
 
  geom_vline(xintercept=as.Date("2014-11-17"),color="253494", origin= "1970-01-01", 
             lty=2, lwd=2) +
  geom_vline(xintercept=as.Date("2017-11-27"), color="253494", lty=2, lwd=2)+
  geom_vline(xintercept=as.Date("2018-12-04"),color="253494", 
             origin= "1970-01-01", lty=2, lwd=2) +
  geom_smooth(aes(x = Date, y = DO, span=0.1), se=FALSE, 
              color="indianred3", linetype=1, size=2)+
  labs(title="The Effect of Sample Date on Dissolved Oxygen Concentrations in East Oahu", 
       x="Sample Date",
       y="Dissolved Oxygen (mg/L)") +
  scale_x_date(labels = date_format("%m/%Y"), 
               breaks = date_breaks("6 month")) +
 scale_y_continuous(limits=c(0,10), breaks=seq(0,10, by = 0.5))
EastOahuTimeSeries
```


#Effect of Sample Date on Dissolved Oxygen Concentration

```{r, echo=FALSE}
OahuDataClean$Date<-as.Date(OahuDataClean$Date,format = "%m/%d/%y")
```

```{r DO, warning=FALSE, message=FALSE, fig.height =9, fig.width = 19, echo=FALSE}
library(wesanderson)
OahuDOPlot<-ggplot(OahuDataClean, aes(x = Date, y = DO, color = Region)) + 
  geom_point(alpha=1) +
scale_color_manual(values=wes_palette(name="GrandBudapest2", type=c("discrete"))) +

  geom_smooth(aes(x = Date, y = DO, span=0.1), color="black", linetype=1, size=2) +
  labs(title="The Effect of Sample Date on Dissolved Oxygen Concentrations in Oahu", 
       x="Sample Date",
       y="Dissolved Oxygen (mg/L)") +
  scale_x_date(labels = date_format("%m/%y"), 
               breaks = date_breaks("6 month")) +
  scale_y_continuous(limits=c(0,10), breaks=seq(0,10, by = 1))


OahuDOPlot
```

#Effect of Sample Date on Water Temperature in Oahu
```{r Temp, warning=FALSE, message=FALSE, fig.height =9, fig.width = 19, echo=FALSE}
library(wesanderson)
OahuTemperaturePlot<-ggplot(OahuDataClean, aes(x = Date, y = Temperature, color = Region)) + 
  geom_point(alpha=1) +
scale_color_manual(values=wes_palette(name="GrandBudapest2")) +
 

  geom_smooth(aes(x = Date, y = Temperature, span=0.1, method="lm"), color="black", 
              linetype=1, size=2) +
  labs(title="The Effect of Sample Date on Water Temperatures in Oahu", 
       x="Sample Date",
       y="Water Temperature(degrees C)") +
  scale_x_date(labels = date_format("%m/%y"),
               breaks = date_breaks("6 month")) +
  scale_y_continuous(limits=c(20,29), breaks=seq(20, 29, by =1))


OahuTemperaturePlot
```

#Effect of Sample Date on pH in Oahu
```{r pH, warning=FALSE, message=FALSE, fig.height =9, fig.width = 19, echo=FALSE}
library(wesanderson)
OahupHPlot<-ggplot(OahuDataClean, aes(x = Date, y =pH, color = Region)) + 
  geom_point(alpha=1) +
scale_color_manual(values=wes_palette(name="GrandBudapest2")) +

  geom_smooth(aes(x = Date, y =pH, span=0.1, method="lm"), color="black", 
              linetype=1, size=2) +
  labs(title="The Effect of Sample Date on pH in Oahu", 
       x="Sample Date",
       y="pH") +
  scale_x_date(labels = date_format("%m/%y"), 
               breaks = date_breaks("6 month")) +
scale_y_continuous(limits=c(7.4,8.8), breaks=seq(7.4, 8.8, by = 0.1))


OahupHPlot

```

#Effect of Sample Date on Salinity in Oahu
```{r Salinity, warning=FALSE, message=FALSE, fig.height =9, fig.width = 19, echo=FALSE}
library(wesanderson)
OahuSalinityPlot<-ggplot(OahuDataClean, aes(x = Date, y =Salinity, color = Region)) + 
  geom_point(alpha=1) +
scale_color_manual(values=wes_palette(name="GrandBudapest2")) +

  geom_smooth(aes(x = Date, y =Salinity, span=0.1), color="black", 
              linetype=1, size=2) +
  labs(title="The Effect of Sample Date on Salinity in Oahu", 
       x="Sample Date",
       y="Salinity (ppt)") +

 scale_x_date(labels = date_format("%m/%y"),
              breaks = date_breaks("6 month")) +
scale_y_continuous(limits=c(0,40), breaks=seq(0, 40, by = 5))


OahuSalinityPlot

```

#Comparison of pH, DO and Temperature over Time in Oahu
```{r, fig.height=13, fig.width=19, message=FALSE, warning=FALSE, echo=FALSE}
library(grid)
pHTempDO<-grid.arrange(OahuDOPlot, OahuTemperaturePlot, OahupHPlot, nrow=3, top = textGrob("Comparison of DO, Temperature, and pH in Oahu", gp=gpar(fontsize=20,font=3)))
```


  
#Summary and Conclusions


  Using exploratory plots, I found that the data is not normally distributed, like most environmental datasets. As seen by my exploratory plots, some of my variables were right skewed with some extreme values and outliers. However, assumptions of multiple linear regression are independence of error terms, homoscedasticity(constant variance) of errors, normality of the error distribution, explanatory variables are fixed, and no perfect multicollinearity. I decided to proceed with a multiple linear regression, as my residual errors looked fine.  The maximal model is HawaiiModClean with all relevant independent variables included. 
  
  Using my GGPairs Bivariate scatterplots for all variable combinations allowed me to look at the correlation coefficients between each variable combination, to ensure there is no multicollinearity between the independent variables, and the independent and dependent variables are linearly correlated. Enterococcus and DO have almost no correlation: 0.005. Temperature and DO have a low positive correlation: 0.104. Salinity and DO have a low positive correlation: 0.147. pH and DO have a low positive correlation: 0.169. Turbidity and DO have almost no correlation: -0.019. Percent Saturation DO and DO are multicollineated because they are related variables, so I did not include Percent Saturation of DO in my analysis.


  I used the stepwise reduction methodto remove the least significant independent variables from the maximal model until only the independent variables with a significant effect on dissolved oxygen concentrations were left, leaving the most parsimonious model HawaiiModClean3. An AIC test was done comparing our final reduced model to our fuller models to determine a goodness of fit score. Our final reduced model had an AIC score 77790.15. While this wasn't the lowest model score, it was within three points of the next score, and Turbidity was not statistically significant with a p-value >0.05, so I removed it. My multiple linear regression found that the explanatory parameters of temperature, pH, salinity, and Enterococci concentrations were significant predictors of dissolved oxygen concentrations in Oahu. A VIF test found that none of these parameters suffered from multicollinearity. The following are their respective statistics: Temperature (p=4.34e-05, t=4.09), Enterococcus (t=2.42, p=0.015), Salinity (t=13.096, p<2e-16), and pH(t=19.03, p<2e-16). 
  
  
  Based on the model coefficients, a one degree Celsius increase in temperature will result in an increase in dissolved oxygen concentrations by 0.02 mg/L. A one ppt increase in Salinity will result in an increase in dissolved oxygen concentrations by 0.042 mg/L. A one unit increase in pH will result in an increase in dissolved oxygen concentrations by 0.17 mg/L. A one unit increase in Enterococcus will result in an increase in dissolved oyxgen concentrations by 9.99e-5 mg/L. (Linear Regression; p<0.05, df=15,449, Rsqaured=0.04). The linear equation for my regression is Dissolved Oxygen=2.42 + 0.02(Temperature)+0.042(Salinity) + 0.17(pH) +9.99e-5(Enterococcus) + E. If I had more time, I would have researched interactions between these parameters to see which interactions would have been the most beneficial to include in my maximal model. My model only explains 4% of the variability of the data around its mean, and perhaps certain interactions would account for more of the variability.

  If I had more available parameters in my data such as phosphorus and nitrate concentrations, they might explain more of the variability in my dataset that my multiple linear regression failed to explain. Phoshorus and nitrate often end up in water bodies as runoff from agriculture/anthropogenic activity and deplete the dissolved oxygen necessary for aerobic activity in water bodies. Because Honolulu (the capital of Hawaii) is on the South coast of Oahu, I surmise that DO concentrations would be lower on the south coast if I was able to include phosphorus and nitrate measurements in my data.  In addition, if I had data on marine organisms (that use up oxygen) or ocean circulation/stratification, that would also explain more of the variability. 

  My second research question concerned whether dissolved oxygen concentrations varied spatially across the North, South, East, and West coasts of Oahu. An exploratory boxplot showed that the median of DO concentrations on the South Coast was slightly lower than the median DO Concentrations of the North, West, and East coasts. Honolulu is located on the South coast and several samples were taken by the capital city, but this is not enough evidence to draw a conclusion.  
